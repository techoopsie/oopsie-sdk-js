!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("OopsieSite",[],t):"object"==typeof exports?exports.OopsieSite=t():e.OopsieSite=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";var n=r(1);e.exports=n},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),s=function(){function e(t,r,o){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"OospieSite";if(n(this,e),void 0===r||"string"!=typeof r||""===r)throw new Error("Oopsie needs an siteId to work.");if(void 0===o||"string"!=typeof o||""===o)throw new Error("Oopsie needs an customerId to work.");this._name=s,this.siteId=r,this.prodEndpoint=t,this.customerId=o,this.oopsieService=new i(this.prodEndpoint,this.siteId,this.customerId)}return o(e,[{key:"init",value:function(e){var t=this;this.oopsieService.init(function(r){e(r,t)})}},{key:"setApiKey",value:function(e){this.oopsieService.setApiKey(e)}},{key:"getApp",value:function(e){return this.oopsieService.getApp(e)}},{key:"getApps",value:function(){return this.oopsieService.getApps()}},{key:"me",value:function(e){return this._restHelper().get("/api/v1/users/me",e)}},{key:"isLoggedIn",value:function(e){return this.me(function(t,r){return t&&401===t.status?e(null,!1):t?e(t,!1):void e(null,!0)})}},{key:"login",value:function(e,t){return this._restHelper().post("/api/v1/users/login",e,t)}},{key:"register",value:function(e,t){return this._restHelper().post("/api/v1/users/register",e,t)}},{key:"logout",value:function(e){return this._restHelper().post("/api/v1/users/logout",null,e)}},{key:"refresh",value:function(e){return this._restHelper().post("/api/v1/users/refresh",null,e)}},{key:"_restHelper",value:function(){return this.oopsieService.getRestHelper()}},{key:"name",get:function(){return this._name}}]),e}();e.exports=s},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(3),s=r(11),u=function(){function e(t,r,o){n(this,e),this.siteId=r,this.customerId=o,this.prodEndpoint=t,this.restHelper=new i,this.restHelper.setProdUrl(t),this.restHelper.setSiteId(r),this.restHelper.setCustomerId(o),this.apps={}}return o(e,[{key:"init",value:function(e){var t=this;this.restHelper.get("/api/v1/init",function(r,n){if(r)return e(r);for(var o in n)t.apps[o]=new s(o,n[o],t.restHelper);e(null)})}},{key:"setApiKey",value:function(e){this.restHelper.setApiKey(e)}},{key:"getApp",value:function(e){return this.apps[e]}},{key:"getApps",value:function(){return this.apps}},{key:"getRestHelper",value:function(){return this.restHelper}}]),e}();e.exports=u},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),s=function(){function e(){n(this,e)}return o(e,[{key:"setProdUrl",value:function(e){this.url=e}},{key:"getProdUrl",value:function(){return this.url}},{key:"setCustomerId",value:function(e){this.customerId=e,this.headers["oopsie-customer-id"]=e}},{key:"setSiteId",value:function(e){this.siteId=e,this.headers=this.headers||{},this.headers["oopsie-site-id"]=e}},{key:"setApiKey",value:function(e){this.apiKey=e,this.headers.Authorization=e}},{key:"get",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.json;return this.send(this.url+this.appendFirstSlash(e),"GET",null,t,n)}},{key:"post",value:function(e,t,r){return this.send(this.url+this.appendFirstSlash(e),"POST",t,r)}},{key:"put",value:function(e,t,r){return this.send(this.url+this.appendFirstSlash(e),"PUT",t,r)}},{key:"delete",value:function(e,t){return this.send(this.url+this.appendFirstSlash(e),"DELETE",null,t)}},{key:"appendFirstSlash",value:function(e){return 0!==e.indexOf("/")&&(e="/"+e),e}},{key:"send",value:function(e,t,r,n){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s={url:e,method:t,headers:this.headers,withCredentials:!0,json:o};r&&(s.body=r),o||(console.log("Binary!"),s.responseType="blob"),i(s,function(e,t,r){if(n){if(e)return n(e);if(t.statusCode>=400){var o={message:void 0===r||""===r?"No error message":r.message,status:t.statusCode};return n(o)}n(null,r)}})}},{key:"mock",value:function(e){i.XMLHttpRequest=e}}]),e}();e.exports=s},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<e.length;r++)t(e[r])}function o(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function i(e,t,r){var n=e;return f(t)?(r=t,"string"==typeof e&&(n={uri:e})):n=h(t,{uri:e}),n.callback=r,n}function s(e,t,r){return t=i(e,t,r),u(t)}function u(e){function t(){4===l.readyState&&setTimeout(i,0)}function r(){var e=void 0;if(e=l.response?l.response:l.responseText||a(l),m)try{e=JSON.parse(e)}catch(e){}return e}function n(e){return clearTimeout(y),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,c(e,k)}function i(){if(!h){var t;clearTimeout(y),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var n=k,o=null;return 0!==t?(n={body:r(),statusCode:t,method:v,headers:{},url:d,rawRequest:l},l.getAllResponseHeaders&&(n.headers=p(l.getAllResponseHeaders()))):o=new Error("Internal XMLHttpRequest Error"),c(o,n,n.body)}}if("undefined"==typeof e.callback)throw new Error("callback argument missing");var u=!1,c=function(t,r,n){u||(u=!0,e.callback(t,r,n))},l=e.xhr||null;l||(l=e.cors||e.useXDR?new s.XDomainRequest:new s.XMLHttpRequest);var f,h,y,d=l.url=e.uri||e.url,v=l.method=e.method||"GET",b=e.body||e.data,w=l.headers=e.headers||{},g=!!e.sync,m=!1,k={body:void 0,headers:{},statusCode:0,method:v,url:d,rawRequest:l};if("json"in e&&e.json!==!1&&(m=!0,w.accept||w.Accept||(w.Accept="application/json"),"GET"!==v&&"HEAD"!==v&&(w["content-type"]||w["Content-Type"]||(w["Content-Type"]="application/json"),b=JSON.stringify(e.json===!0?b:e.json))),l.onreadystatechange=t,l.onload=i,l.onerror=n,l.onprogress=function(){},l.onabort=function(){h=!0},l.ontimeout=n,l.open(v,d,!g,e.username,e.password),g||(l.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(y=setTimeout(function(){if(!h){h=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",n(e)}},e.timeout)),l.setRequestHeader)for(f in w)w.hasOwnProperty(f)&&l.setRequestHeader(f,w[f]);else if(e.headers&&!o(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(b||null),l}function a(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}function c(){}var l=r(5),f=r(6),p=r(7),h=r(10);e.exports=s,s.XMLHttpRequest=l.XMLHttpRequest||c,s.XDomainRequest="withCredentials"in new s.XMLHttpRequest?s.XMLHttpRequest:l.XDomainRequest,n(["get","put","post","patch","head","delete"],function(e){s["delete"===e?"del":e]=function(t,r,n){return r=i(t,r,n),r.method=e.toUpperCase(),u(r)}})},function(e,t){(function(t){var r;r="undefined"!=typeof window?window:"undefined"!=typeof t?t:"undefined"!=typeof self?self:{},e.exports=r}).call(t,function(){return this}())},function(e,t){function r(e){var t=n.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}e.exports=r;var n=Object.prototype.toString},function(e,t,r){var n=r(8),o=r(9),i=function(e){return"[object Array]"===Object.prototype.toString.call(e)};e.exports=function(e){if(!e)return{};var t={};return o(n(e).split("\n"),function(e){var r=e.indexOf(":"),o=n(e.slice(0,r)).toLowerCase(),s=n(e.slice(r+1));"undefined"==typeof t[o]?t[o]=s:i(t[o])?t[o].push(s):t[o]=[t[o],s]}),t}},function(e,t){function r(e){return e.replace(/^\s*|\s*$/g,"")}t=e.exports=r,t.left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}},function(e,t,r){function n(e,t,r){if(!u(t))throw new TypeError("iterator must be a function");arguments.length<3&&(r=this),"[object Array]"===a.call(e)?o(e,t,r):"string"==typeof e?i(e,t,r):s(e,t,r)}function o(e,t,r){for(var n=0,o=e.length;n<o;n++)c.call(e,n)&&t.call(r,e[n],n,e)}function i(e,t,r){for(var n=0,o=e.length;n<o;n++)t.call(r,e.charAt(n),n,e)}function s(e,t,r){for(var n in e)c.call(e,n)&&t.call(r,e[n],n,e)}var u=r(6);e.exports=n;var a=Object.prototype.toString,c=Object.prototype.hasOwnProperty},function(e,t){function r(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var o in r)n.call(r,o)&&(e[o]=r[o])}return e}e.exports=r;var n=Object.prototype.hasOwnProperty},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(12),s=function(){function e(t,r,o){n(this,e),this.name=t,this.resources={};for(var s=0;s<r.resources.length;s++)this.resources[r.resources[s].name]=new i(r.resources[s],o)}return o(e,[{key:"getResource",value:function(e){if(!this.resources[e]){var t="Resource "+e+" doesn't exist in your application.\nAvailable resources are: ";throw t+=Object.keys(this.resources),new Error(t)}return this.resources[e]}}]),e}();e.exports=s},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(13),s=r(15),u=r(16),a=r(17),c=function(){function e(t,r){n(this,e),this.resourceName=t.name,this.id=t.id,this.attributes=t.attributes,this.views=t.views,this.auths=t.auths,this.authEnabled=t.authEnabled,this._resource=t,this.restHelper=r}return o(e,[{key:"hasAuthEnabled",value:function(){return this.authEnabled}},{key:"create",value:function(){return new u(this.id,this.restHelper)}},{key:"save",value:function(){return new a(this.id,this.restHelper)}},{key:"delete",value:function(){return new s(this.id,this.restHelper)}},{key:"get",value:function(){return new i(this.id,this._resource.type,this.restHelper)}}]),e}();e.exports=c},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(14),a=function(e){function t(e,r,i){n(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.view=null,s._audit=!1,s.type=r,s.restHelper=i,s}return i(t,e),s(t,[{key:"byView",value:function(e){return this.view=e,this}},{key:"limit",value:function(e){if(e<0||e>1e3)throw new Error("Limit has to be between 0-1000.");return this.limitBy=e,this}},{key:"hasNextPage",value:function(){return null!==this.nextPageUrl}},{key:"nextPage",value:function(e){var t=this,r=this.nextPageUrl.substring(this.restHelper.getProdUrl().length);return this.restHelper.get(r,function(r,n){return r?e(r):(t.nextPageUrl=n.metadata.nextPageUrl,t.prevPageUrl=n.metadata.prevPageUrl,void e(null,n))}),this}},{key:"hasPrevPage",value:function(){return null!==this.prevPageUrl}},{key:"prevPage",value:function(e){var t=this,r=this.prevPageUrl.substring(this.restHelper.getProdUrl().length);return this.restHelper.get(r,function(r,n){return r?e(r):(t.nextPageUrl=n.metadata.nextPageUrl,t.prevPageUrl=n.metadata.prevPageUrl,void e(null,n))}),this}},{key:"execute",value:function(e){var t=this;return this.restHelper.get(this._getUrl(),function(r,n){return r?e(r):(n.metadata&&(t.nextPageUrl=n.metadata.nextPageUrl,t.prevPageUrl=n.metadata.prevPageUrl),void e(null,n))},{json:"BINARY"!==this.type}),this}}]),t}(u);e.exports=a},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){r(this,e),this.url="/api/v1/resources/"+t,this.limitBy=-1}return n(e,[{key:"withParams",value:function(e){return this.params=e,this}},{key:"_getUrl",value:function(){var e=this.url;this.view&&(e+="/views/"+this.view);for(var t in this.params)this.params.hasOwnProperty(t)&&(e=this._addQueryParam(t,this.params[t],e));return this.limitBy!==-1&&(e=this._addQueryParam("_limit",this.limitBy,e)),e}},{key:"_addQueryParam",value:function(e,t,r){return r+=r.indexOf("?")===-1?"?"+e+"="+t:"&"+e+"="+t}}]),e}();e.exports=o},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(14),a=function(e){function t(e,r){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.restHelper=r,i}return i(t,e),s(t,[{key:"execute",value:function(e){this.restHelper.delete(this._getUrl(),e)}}]),t}(u);e.exports=a},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(14),a=function(e){function t(e,r){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.restHelper=r,i}return i(t,e),s(t,[{key:"execute",value:function(e){this.restHelper.post(this.url,this.params,e)}}]),t}(u);e.exports=a},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(14),a=function(e){function t(e,r){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.restHelper=r,i}return i(t,e),s(t,[{key:"withParams",value:function(e){if(this.params=e,!this.params.id)throw new Error("Save needs an id. Batch update not supported yet.");return this}},{key:"execute",value:function(e){this.restHelper.put(this.url,this.params,e)}}]),t}(u);e.exports=a}])});
//# sourceMappingURL=oopsie.min.js.map